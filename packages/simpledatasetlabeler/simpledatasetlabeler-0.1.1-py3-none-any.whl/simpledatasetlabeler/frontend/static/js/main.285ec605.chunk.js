(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{71:function(e,t,n){},76:function(e,t,n){},80:function(e,t,n){},81:function(e,t,n){},82:function(e,t,n){"use strict";n.r(t);var a=n(0),c=n.n(a),r=n(10),i=n.n(r),s=(n(71),n(17)),u=n.n(s),o=n(25),l=n(18),b=n(111),d=n(112),j=n(43),f=n(113),h=n(114),O=n(26),m=n(8),g=n(105),p=n(116),v=n(13),_=(n(76),n(2));function x(e){var t=Object(v.c)((function(e){return e.dataset.num_images})),n=Object(v.c)((function(e){return e.dataset.run_id})),c=Object(a.useState)(0),r=Object(l.a)(c,2),i=r[0],s=r[1],u=100*i,o=Math.min(t,100*(i+1)),b=Array.from(new Array(o-u),(function(e,t){return t+u})),d=Math.ceil(t/100);return Object(_.jsxs)("div",{children:[Object(_.jsx)("div",{className:"header",children:Object(_.jsxs)(j.a,{variant:"h5",children:["Total ",t," images"]})}),Object(_.jsx)(g.a,{container:!0,spacing:2,children:b.map((function(e){return Object(_.jsx)(g.a,{item:!0,sm:3,xs:6,className:"image_container",children:Object(_.jsx)(O.b,{to:"/images/"+e,children:Object(_.jsx)("img",{src:"/api/images/"+e+"?run="+n})})},e)}))}),Object(_.jsx)("div",{className:"footer",children:Object(_.jsx)(p.a,{count:d,page:i+1,onChange:function(e,t){return s(t-1)},className:"footer_pagination"})})]})}var w=n(108),y=n(32),k=(n(80),n(59)),S=n(28),C=n(57),E=n(58),M=new(function(){function e(t){Object(C.a)(this,e),this.base_url=t}return Object(E.a)(e,[{key:"get_metadata",value:function(){var e=Object(o.a)(u.a.mark((function e(){var t,n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.base_url+"/api/metadata",e.next=3,fetch(t);case 3:return n=e.sent,e.abrupt("return",n.json());case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"get_image_labels",value:function(){var e=Object(o.a)(u.a.mark((function e(t){var n,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.base_url+"/api/labels/"+t,e.next=3,fetch(n);case 3:return a=e.sent,e.abrupt("return",a.json());case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"put_image_labels",value:function(){var e=Object(o.a)(u.a.mark((function e(t,n){var a,c;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=this.base_url+"/api/labels/"+t,e.next=3,fetch(a,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});case 3:return c=e.sent,e.abrupt("return",c.json());case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"post_save",value:function(){var e=Object(o.a)(u.a.mark((function e(){var t,n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.base_url+"/api/save",e.next=3,fetch(t,{method:"POST"});case 3:return n=e.sent,e.abrupt("return",n.json());case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"post_stop",value:function(){var e=Object(o.a)(u.a.mark((function e(){var t,n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.base_url+"/api/stop",e.next=3,fetch(t,{method:"POST"});case 3:return n=e.sent,e.abrupt("return",n.json());case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}())(""),N=Object(S.b)("dataset/get_metadata",(function(){return M.get_metadata()})),X=Object(S.b)("labels/get_image_labels",(function(e){return M.get_image_labels(e)})),Y=Object(S.b)("labels/add_annotation",(function(e,t){var n=t.getState,a=e.image_id,c=e.annotation,r=n().labels[a],i=[].concat(Object(k.a)(r),[c]);return M.put_image_labels(a,i)})),L=Object(S.b)("labels/remove_annotation",(function(e,t){var n=t.getState,a=e.image_id,c=e.annotation,r=n().labels[a],i=JSON.stringify(c),s=r.filter((function(e){return JSON.stringify(e)!==i}));return M.put_image_labels(a,s)})),R=Object(S.c)({name:"dataset",initialState:{num_images:0,labels:[],run_id:null},reducers:{},extraReducers:function(e){e.addCase(N.fulfilled,(function(e,t){e.num_images=t.payload.num_images,e.labels=t.payload.labels,e.run_id=t.payload.run_id}))}}),J=Object(S.c)({name:"labels",initialState:{},reducers:{},extraReducers:function(e){e.addCase(X.fulfilled,(function(e,t){e[t.meta.arg]=t.payload})),e.addCase(Y.fulfilled,(function(e,t){e[t.meta.arg.image_id].push(t.meta.arg.annotation)})),e.addCase(L.fulfilled,(function(e,t){var n=JSON.stringify(t.meta.arg.annotation),a=e[t.meta.arg.image_id].findIndex((function(e){return JSON.stringify(e)===n}));e[t.meta.arg.image_id].splice(a,1)}))}}),T=Object(S.a)({reducer:{dataset:R.reducer,labels:J.reducer}});function D(e){var t=Object(v.c)((function(e){return e.dataset.labels})),n=Math.max(0,e.annotation[1]),c=Math.max(0,e.annotation[2]),r=Math.min(e.image_width,e.annotation[3]),i=Math.min(e.image_height,e.annotation[4]),s=e.background_ref,u=e.set_active,o={left:n*e.scale,top:c*e.scale,width:(r-n)*e.scale,height:(i-c)*e.scale},l=Object(a.useCallback)((function(e){u()}),[u]),b=Object(a.useCallback)((function(e){s.current.dispatchEvent(new MouseEvent("mousedown",{screenX:e.screenX,screenY:e.screenY,clientX:e.clientX,clientY:e.clientY,relatedTarget:e.target,bubbles:e.bubbles,button:e.button}))}),[s]),d=Object(a.useCallback)((function(e){s.current.dispatchEvent(new MouseEvent("mousemove",{screenX:e.screenX,screenY:e.screenY,clientX:e.clientX,clientY:e.clientY,relatedTarget:s.current,bubbles:e.bubbles,button:e.button,buttons:e.buttons}))}),[s]),j=t[e.annotation[0]];return Object(_.jsx)("div",{style:o,className:"annotation_box"+(e.active?" active":""),onClick:l,onMouseDown:b,onMouseMove:d,children:Object(_.jsx)("div",{className:"annotation_box_label",children:j})})}function P(e){var t=Object(a.useState)(!1),n=Object(l.a)(t,2),c=n[0],r=n[1],i=Object(a.useState)(null),s=Object(l.a)(i,2),u=s[0],o=s[1],b=Object(v.b)(),d=Object(y.b)().enqueueSnackbar,j=e.canvas_ref,f=Object(a.useCallback)((function(t,n,a,c){var r=j.current.getContext("2d");r.clearRect(0,0,j.current.width,j.current.height),r.fillStyle="rgba(0, 0, 255, 0.5)",r.fillRect(t/e.scale,n/e.scale,(a-t)/e.scale,(c-n)/e.scale)}),[e.scale,j]),h=Object(a.useCallback)((function(t,n,a,c){if(t!==a&&n!==c){var r=Math.min(t,a),i=Math.min(n,c),s=Math.max(t,a),u=Math.max(n,c);null!==e.selected_label?b(Y({image_id:e.image_id,annotation:[e.selected_label,r/e.scale,i/e.scale,s/e.scale,u/e.scale]})):d("Please select a tag first.")}}),[b,e.image_id,e.scale,e.selected_label,d]),O=Object(a.useCallback)((function(e){if(c&&0!==e.buttons&&c){var t=e.target.getBoundingClientRect(),n=t.x,a=t.y,r=e.pageX-n-window.scrollX,i=e.pageY-a-window.scrollY,s=Object(l.a)(u,2),o=s[0],b=s[1];f(o,b,r,i)}}),[f,c,u]),m=Object(a.useCallback)((function(e){r(!0);var t=e.target.getBoundingClientRect(),n=t.x,a=t.y;o([e.pageX-n-window.scrollX,e.pageY-a-window.scrollY])}),[r]),g=Object(a.useCallback)((function(e){if(c){r(!1),j.current.getContext("2d").clearRect(0,0,j.current.width,j.current.height);var t=j.current.getBoundingClientRect(),n=t.x,a=t.y,i=e.pageX-n-window.scrollX,s=e.pageY-a-window.scrollY,o=Object(l.a)(u,2),b=o[0],d=o[1];h(b,d,i,s)}}),[r,j,h,c,u]);return Object(a.useEffect)((function(){return window.addEventListener("mouseup",g),function(){return window.removeEventListener("mouseup",g)}}),[g]),Object(_.jsx)("canvas",{ref:j,width:e.width,height:e.height,className:"image_annotator_canvas",onMouseMove:O,onMouseDown:m})}function q(e){var t=Object(a.useRef)(null),n=Object(v.c)((function(t){return t.labels[e.image_id]||[]})),c=Object(a.useState)(1),r=Object(l.a)(c,2),i=r[0],s=r[1],u=Object(a.useState)(100),o=Object(l.a)(u,2),b=o[0],d=o[1],j=Object(a.useState)(100),f=Object(l.a)(j,2),h=f[0],O=f[1],m=Object(a.useState)(-1),g=Object(l.a)(m,2),p=g[0],x=g[1],w=Object(a.useRef)(null),y=Object(v.b)(),k=Object(v.c)((function(e){return e.dataset.run_id}));Object(a.useEffect)((function(){function e(){s(t.current.width/t.current.naturalWidth)}return window.addEventListener("resize",e),function(){return window.removeEventListener("resize",e)}}),[t]);var S=Object(a.useCallback)((function(t){"Delete"===t.code&&p>=0&&(console.log("removing"),y(L({image_id:e.image_id,annotation:n[p]})),x(-1))}),[y,p,x,n,e.image_id]);return Object(a.useEffect)((function(){return window.addEventListener("keydown",S),function(){return window.removeEventListener("keydown",S)}}),[S]),Object(_.jsxs)("div",{className:"image_annotator",children:[Object(_.jsx)("img",{ref:t,className:"image_annotator_img",src:"/api/images/"+e.image_id+"?run="+k,onLoad:function(){s(t.current.width/t.current.naturalWidth),d(t.current.naturalWidth),O(t.current.naturalHeight)},alt:"annotation target"}),Object(_.jsx)(P,{canvas_ref:w,scale:i,width:b,height:h,image_id:e.image_id,selected_label:e.selected_label}),n.map((function(e,t){return Object(_.jsx)(D,{annotation:e,scale:i,image_width:b,image_height:h,background_ref:w,active:p===t,set_active:function(){return x(t)}},JSON.stringify(e))}))]})}var z=n(83),B=n(106),I=n(117),A=n(107),W={65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",97:"a",98:"b",99:"c",100:"d",101:"e",102:"f",103:"g",104:"h",105:"i",106:"j",107:"k",108:"l",109:"m",110:"n",111:"o",112:"p",113:"q",114:"r",115:"s",116:"t",117:"u",118:"v",119:"w",120:"x",121:"y",122:"z"};function H(e){var t=Object(v.c)((function(e){return e.dataset.labels})),n=Object(a.useState)({0:81,1:87,2:69,3:82,4:65,5:83,6:68,7:70}),c=Object(l.a)(n,1)[0],r=e.selected_label,i=e.set_selected_label,s=Object.keys(c).reduce((function(e,t){return e[c[t]]=parseInt(t),e}),{}),u=Object(a.useCallback)((function(e){if(e.keyCode in s){var n=s[e.keyCode];n<t.length&&i(n)}}),[s,i,t]);return Object(a.useEffect)((function(){return window.addEventListener("keydown",u),function(){return window.removeEventListener("keydown",u)}}),[u]),Object(_.jsx)("div",{children:Object(_.jsx)(z.a,{variant:"outlined",children:Object(_.jsx)(B.a,{dense:!0,children:t.map((function(t,n){return Object(_.jsx)(I.a,{button:!0,onClick:function(){return e.set_selected_label(n)},selected:r===n,children:Object(_.jsx)(A.a,{primary:t+(n in c?"  (key: "+W[c[n]]+")":"")})},n)}))})})})}var K=n(109),U=n(110);function F(e){var t=Object(m.g)(),n=parseInt(t.image_id),c=Object(v.c)((function(e){return e.dataset.num_images})),r=Object(v.b)();Object(a.useEffect)((function(){r(X(n))}),[r,n]);var i=Object(m.f)(),s=Object(a.useCallback)((function(e){32===e.keyCode&&(e.shiftKey?n>0&&i.push("/images/"+(n-1)):n<c-1&&i.push("/images/"+(n+1)))}),[n,i,c]);return Object(a.useEffect)((function(){return window.addEventListener("keydown",s),function(){return window.removeEventListener("keydown",s)}}),[s]),Object(_.jsxs)("div",{className:"image_view",children:[Object(_.jsxs)(j.a,{variant:"h5",children:[n>0&&Object(_.jsx)(w.a,{children:Object(_.jsx)(O.b,{to:"/images/"+(n-1),children:Object(_.jsx)(K.a,{})})}),n," / ",c,n<c-1&&Object(_.jsx)(w.a,{children:Object(_.jsx)(O.b,{to:"/images/"+(n+1),children:Object(_.jsx)(U.a,{})})})]}),Object(_.jsxs)(g.a,{container:!0,spacing:2,children:[Object(_.jsx)(g.a,{item:!0,xs:9,children:Object(_.jsx)(q,{image_id:n,selected_label:e.selected_label})}),Object(_.jsxs)(g.a,{item:!0,xs:3,children:[Object(_.jsx)(j.a,{variant:"h6",children:"Labels"}),Object(_.jsx)(H,{selected_label:e.selected_label,set_selected_label:e.set_selected_label})]})]})]})}n(81);var G=function(){var e=Object(v.b)();Object(a.useEffect)((function(){e(N())}),[e]);var t=Object(y.b)().enqueueSnackbar,n=Object(a.useState)(null),c=Object(l.a)(n,2),r=c[0],i=c[1];function s(){return(s=Object(o.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,M.post_save();case 2:t("Saved");case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(){return(g=Object(o.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t("Server is shutting down... Please close this window."),e.next=3,M.post_stop();case 3:t("Server is successfully stopped.");case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(_.jsx)("div",{className:"App",children:Object(_.jsxs)(O.a,{children:[Object(_.jsx)(b.a,{position:"static",color:"transparent",children:Object(_.jsxs)(d.a,{variant:"dense",children:[Object(_.jsx)(j.a,{id:"logo",variant:"h5",component:O.b,to:"/",color:"inherit",children:"Simple Dataset Labeler"}),Object(_.jsx)(f.a,{id:"save_button",onClick:function(){return s.apply(this,arguments)},children:"Save"}),Object(_.jsx)(f.a,{id:"exit_button",onClick:function(){return g.apply(this,arguments)},children:"Exit"})]})}),Object(_.jsx)(h.a,{children:Object(_.jsxs)(m.c,{children:[Object(_.jsx)(m.a,{path:"/images/:image_id",children:Object(_.jsx)(F,{selected_label:r,set_selected_label:i})}),Object(_.jsx)(m.a,{path:"/",exact:!0,children:Object(_.jsx)(x,{})})]})})]})})};i.a.render(Object(_.jsx)(c.a.StrictMode,{children:Object(_.jsx)(v.a,{store:T,children:Object(_.jsx)(y.a,{maxSnack:3,autoHideDuration:3e3,children:Object(_.jsx)(G,{})})})}),document.getElementById("root"))}},[[82,1,2]]]);
//# sourceMappingURL=main.285ec605.chunk.js.map