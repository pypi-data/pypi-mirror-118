{"version":3,"sources":["home_view.js","api.js","redux/store.js","image_annotator.js","shortcut_key_view.js","image_view.js","app.js","index.js"],"names":["HomeView","props","num_images","useSelector","state","dataset","run_id","useState","page","set_page","start_index","end_index","Math","min","image_indexes","Array","from","x","i","page_count","ceil","className","Typography","variant","Grid","container","spacing","map","item","sm","xs","to","src","Pagination","count","onChange","e","value","base_url","this","a","url","fetch","response","json","image_id","labels","method","headers","body","JSON","stringify","get_metadata","createAsyncThunk","client","get_image_labels","add_annotation","args","getState","annotation","existing_annotations","new_annotations","put_image_labels","remove_annotation","annotation_json","filter","dataset_slice","createSlice","name","initialState","reducers","extraReducers","builder","addCase","fulfilled","action","payload","labels_slice","meta","arg","push","index","findIndex","splice","configureStore","reducer","AnnotationBox","label_names","max","y","x2","image_width","y2","image_height","background_ref","set_active","style","left","scale","top","width","height","on_click","useCallback","on_mouse_down","current","dispatchEvent","MouseEvent","screenX","screenY","clientX","clientY","relatedTarget","target","bubbles","button","on_mouse_move","buttons","active","onClick","onMouseDown","onMouseMove","BoxCanvas","is_active","set_is_active","start_xy","set_start_xy","dispatch","useDispatch","enqueueSnackbar","useSnackbar","canvas_ref","draw_box","ctx","getContext","clearRect","fillStyle","fillRect","commit_box","new_x","new_y","new_x2","new_y2","selected_label","getBoundingClientRect","cur_x","pageX","window","scrollX","cur_y","pageY","scrollY","start_x","start_y","on_mouse_up","useEffect","addEventListener","removeEventListener","ref","ImageAnnotator","image_ref","useRef","image_labels","set_scale","set_image_width","set_image_height","active_box","set_active_box","resize_handler","naturalWidth","on_key_down","code","console","log","onLoad","naturalHeight","alt","v","KEYNAMES","ShortcutKeyView","shortcut_keys","set_selected_label","key_shortcut_map","Object","keys","reduce","acc","key","parseInt","keyCode","selected_label_id","length","Paper","List","dense","n","ListItem","selected","ListItemText","primary","ImageView","params","useParams","history","useHistory","shiftKey","IconButton","NavigateBefore","NavigateNext","App","post_save","post_stop","AppBar","position","color","Toolbar","id","component","Link","Button","Container","path","exact","ReactDOM","render","StrictMode","store","maxSnack","autoHideDuration","document","getElementById"],"mappings":"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","file":"static/js/main.285ec605.chunk.js","sourcesContent":["import { Grid, Typography } from \"@material-ui/core\";\nimport Pagination from \"@material-ui/lab/Pagination\";\nimport { useState } from \"react\";\nimport { useSelector } from \"react-redux\";\nimport { Link } from \"react-router-dom\";\nimport \"./home_view.css\";\n\nconst NUM_PER_PAGE = 100;\n\nexport default function HomeView(props) {\n    const num_images = useSelector(state => state.dataset.num_images);\n    const run_id = useSelector(state => state.dataset.run_id);\n    const [page, set_page] = useState(0);\n    const start_index = page * NUM_PER_PAGE;\n    const end_index = Math.min(num_images, (page + 1) * NUM_PER_PAGE);\n    const image_indexes = Array.from(new Array(end_index - start_index), (x, i) => i + start_index);\n    const page_count = Math.ceil(num_images / NUM_PER_PAGE);\n    return (\n        <div>\n            <div className=\"header\">\n            <Typography variant=\"h5\">Total {num_images} images</Typography>\n            </div>\n            <Grid container spacing={2}>\n                {image_indexes.map((i) => \n                    <Grid item sm={3} xs={6} key={i} className=\"image_container\">\n                        <Link to={\"/images/\" + i}>\n                            <img src={\"/api/images/\" + i + \"?run=\" + run_id} />\n                        </Link>\n                    </Grid>)}\n            </Grid>\n\n            <div className=\"footer\">\n                <Pagination count={page_count} page={page + 1} onChange={(e, value) => set_page(value - 1)} className=\"footer_pagination\" />\n            </div>\n        </div>\n    );\n}","class Api {\n    constructor(base_url) {\n        this.base_url = base_url;\n    }\n\n    async get_metadata() {\n        const url = this.base_url + '/api/metadata';\n        const response = await fetch(url);\n        return response.json();\n    }\n\n    async get_image_labels(image_id) {\n        const url = this.base_url + '/api/labels/' + image_id;\n        const response = await fetch(url);\n        return response.json();\n    }\n\n    async put_image_labels(image_id, labels) {\n        const url = this.base_url + '/api/labels/' + image_id;\n        const response = await fetch(url, {method: 'PUT', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(labels)});\n        return response.json();\n    }\n\n    async post_save() {\n        const url = this.base_url + '/api/save';\n        const response = await fetch(url, {method: 'POST'});\n        return response.json();\n    }\n\n    async post_stop() {\n        const url = this.base_url + '/api/stop';\n        const response = await fetch(url, {method: 'POST'});\n        return response.json();\n    }\n}\n\nexport default new Api(\"\");","import { configureStore, createAsyncThunk, createSlice } from '@reduxjs/toolkit';\nimport client from '../api';\n\nexport const get_metadata = createAsyncThunk('dataset/get_metadata', () => client.get_metadata());\nexport const get_image_labels = createAsyncThunk('labels/get_image_labels', (image_id) => client.get_image_labels(image_id));\nexport const add_annotation = createAsyncThunk('labels/add_annotation', (args, {getState}) => {\n    const {image_id, annotation} = args;\n    const existing_annotations = getState().labels[image_id];\n    const new_annotations = [...existing_annotations, annotation];\n    return client.put_image_labels(image_id, new_annotations);\n});\nexport const remove_annotation = createAsyncThunk('labels/remove_annotation', (args, {getState}) => {\n    const {image_id, annotation} = args;\n    const existing_annotations = getState().labels[image_id];\n    const annotation_json = JSON.stringify(annotation); // I know! this is not efficient...\n    const new_annotations = existing_annotations.filter(x => JSON.stringify(x) !== annotation_json);\n    return client.put_image_labels(image_id, new_annotations);\n});\n\nconst dataset_slice = createSlice({\n    name: 'dataset',\n    initialState: {num_images: 0, labels: [], run_id: null},\n    reducers: {\n\n    },\n    extraReducers: builder => {\n        builder.addCase(get_metadata.fulfilled, (state, action) => {\n            state.num_images = action.payload.num_images;\n            state.labels = action.payload.labels;\n            state.run_id = action.payload.run_id;\n        });\n    }\n});\n\n\nconst labels_slice = createSlice({\n    name: 'labels',\n    initialState: {},\n    reducers: {\n    },\n    extraReducers: builder => {\n        builder.addCase(get_image_labels.fulfilled, (state, action) => {\n            state[action.meta.arg] = action.payload;\n        });\n        builder.addCase(add_annotation.fulfilled, (state, action) => {\n            state[action.meta.arg.image_id].push(action.meta.arg.annotation);\n        });\n        builder.addCase(remove_annotation.fulfilled, (state, action) => {\n            const annotation_json = JSON.stringify(action.meta.arg.annotation);\n            const index = state[action.meta.arg.image_id].findIndex(x => JSON.stringify(x) === annotation_json);\n            state[action.meta.arg.image_id].splice(index, 1);\n        })\n    }\n});\n\n\nexport default configureStore({\n    reducer: {\n        dataset: dataset_slice.reducer,\n        labels: labels_slice.reducer\n    }\n})","import { useSnackbar } from 'notistack';\nimport { useCallback, useEffect, useRef, useState } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport './image_annotator.css';\nimport { add_annotation, remove_annotation } from './redux/store';\n\nfunction AnnotationBox(props) {\n    const label_names = useSelector(state => state.dataset.labels);\n    const x = Math.max(0, props.annotation[1]);\n    const y = Math.max(0, props.annotation[2]);\n    const x2 = Math.min(props.image_width, props.annotation[3]);\n    const y2 = Math.min(props.image_height, props.annotation[4]);\n    const {background_ref, set_active} = props;\n    const style = {\n        left: x * props.scale,\n        top: y * props.scale,\n        width: (x2 - x) * props.scale,\n        height: (y2 - y) * props.scale\n    };\n\n    const on_click = useCallback((e) => {\n        set_active();\n        // TODO: If this box is already active, dispatch the event to the next element?\n    }, [set_active]);\n\n    const on_mouse_down = useCallback((e) => {\n        background_ref.current.dispatchEvent(new MouseEvent(\"mousedown\", {screenX: e.screenX, screenY: e.screenY, clientX: e.clientX, clientY: e.clientY, relatedTarget: e.target, bubbles: e.bubbles, button: e.button}));\n    }, [background_ref]);\n\n    const on_mouse_move = useCallback((e) => {\n        background_ref.current.dispatchEvent(new MouseEvent(\"mousemove\", {screenX: e.screenX, screenY: e.screenY, clientX: e.clientX, clientY: e.clientY, relatedTarget: background_ref.current, bubbles: e.bubbles, button: e.button, buttons: e.buttons}));    \n    }, [background_ref]);\n\n    const name = label_names[props.annotation[0]];\n    return (<div style={style} className={\"annotation_box\" + (props.active ? \" active\" : \"\")} onClick={on_click} onMouseDown={on_mouse_down} onMouseMove={on_mouse_move}>\n                <div className=\"annotation_box_label\">{name}</div>\n            </div>);\n}\n\nfunction BoxCanvas(props) {\n    const [is_active, set_is_active] = useState(false);\n    const [start_xy, set_start_xy] = useState(null);\n    const dispatch = useDispatch();\n    const { enqueueSnackbar } = useSnackbar();\n    const canvas_ref = props.canvas_ref;\n\n    const draw_box = useCallback((x, y, x2, y2) => {\n        const ctx = canvas_ref.current.getContext('2d');\n        ctx.clearRect(0, 0, canvas_ref.current.width, canvas_ref.current.height);\n        ctx.fillStyle = 'rgba(0, 0, 255, 0.5)';\n        ctx.fillRect(x / props.scale, y / props.scale, (x2 - x) / props.scale, (y2 - y) / props.scale);\n    }, [props.scale, canvas_ref]);\n\n    const commit_box = useCallback((x, y, x2, y2) => {\n        if (x === x2 || y === y2) {\n            return;\n        }\n\n        const new_x = Math.min(x, x2);\n        const new_y = Math.min(y, y2);\n        const new_x2 = Math.max(x, x2);\n        const new_y2 = Math.max(y, y2);\n\n        if (props.selected_label === null) {\n            enqueueSnackbar(\"Please select a tag first.\");\n            return;\n        }\n\n        dispatch(add_annotation({image_id: props.image_id, annotation: [props.selected_label, new_x / props.scale, new_y / props.scale, new_x2 / props.scale, new_y2 / props.scale]}));\n    }, [dispatch, props.image_id, props.scale, props.selected_label, enqueueSnackbar]);\n\n    const on_mouse_move = useCallback((e) => {\n        if (!is_active || e.buttons === 0)\n            return;\n\n        if (is_active) {\n            const {x, y} = e.target.getBoundingClientRect();\n            const cur_x = e.pageX - x - window.scrollX;\n            const cur_y = e.pageY - y - window.scrollY;\n            const [start_x, start_y] = start_xy;\n            draw_box(start_x, start_y, cur_x, cur_y);\n        }\n    }, [draw_box, is_active, start_xy]);\n\n    const on_mouse_down = useCallback((e) => {\n        set_is_active(true);\n        const {x, y} = e.target.getBoundingClientRect();\n        set_start_xy([e.pageX - x - window.scrollX, e.pageY - y - window.scrollY]);\n    }, [set_is_active]);\n\n    const on_mouse_up = useCallback((e) => {\n        if (is_active) {\n            set_is_active(false);\n            const ctx = canvas_ref.current.getContext('2d');\n            ctx.clearRect(0, 0, canvas_ref.current.width, canvas_ref.current.height);\n            const {x, y} = canvas_ref.current.getBoundingClientRect();\n            const cur_x = e.pageX - x - window.scrollX;\n            const cur_y = e.pageY - y - window.scrollY;\n            const [start_x, start_y] = start_xy;\n            commit_box(start_x, start_y, cur_x, cur_y);\n        }\n    }, [set_is_active, canvas_ref, commit_box, is_active, start_xy]);\n\n    useEffect(() => {\n        window.addEventListener(\"mouseup\", on_mouse_up);\n        return () => window.removeEventListener(\"mouseup\", on_mouse_up);\n    }, [on_mouse_up]);\n\n    return <canvas ref={canvas_ref} width={props.width} height={props.height} className=\"image_annotator_canvas\" onMouseMove={on_mouse_move} onMouseDown={on_mouse_down} />;\n}\n\nexport default function ImageAnnotator(props) {\n    const image_ref = useRef(null);\n    const image_labels = useSelector(state => state.labels[props.image_id] || []);\n    const [scale, set_scale] = useState(1);\n    const [image_width, set_image_width] = useState(100);\n    const [image_height, set_image_height] = useState(100);\n    const [active_box, set_active_box] = useState(-1);\n    const canvas_ref = useRef(null);\n    const dispatch = useDispatch();\n    const run_id = useSelector(state => state.dataset.run_id);\n\n    useEffect(() => {\n        function resize_handler() {\n            set_scale(image_ref.current.width / image_ref.current.naturalWidth);\n        }\n        window.addEventListener(\"resize\", resize_handler);\n        return () => window.removeEventListener(\"resize\", resize_handler);\n    }, [image_ref]);\n\n    function on_load() {\n        set_scale(image_ref.current.width / image_ref.current.naturalWidth);\n        set_image_width(image_ref.current.naturalWidth);\n        set_image_height(image_ref.current.naturalHeight);\n    }\n\n    const on_key_down = useCallback((e) => {\n        if (e.code === \"Delete\") {\n            if (active_box >= 0) {\n                console.log(\"removing\");\n                dispatch(remove_annotation({image_id: props.image_id, annotation: image_labels[active_box]})); // Remove\n                set_active_box(-1);\n            }\n        }\n    }, [dispatch, active_box, set_active_box, image_labels, props.image_id]);\n\n    useEffect(() => {\n        window.addEventListener(\"keydown\", on_key_down);\n        return () => window.removeEventListener(\"keydown\", on_key_down);\n    }, [on_key_down]);\n\n    return (\n            <div className=\"image_annotator\">\n                <img ref={image_ref} className=\"image_annotator_img\" src={\"/api/images/\" + props.image_id + \"?run=\" + run_id} onLoad={on_load} alt=\"annotation target\" />\n                <BoxCanvas canvas_ref={canvas_ref} scale={scale} width={image_width} height={image_height} image_id={props.image_id} selected_label={props.selected_label} />\n                {image_labels.map((v, i) => <AnnotationBox key={JSON.stringify(v)} annotation={v} scale={scale} image_width={image_width} image_height={image_height} background_ref={canvas_ref} active={active_box === i} set_active={() => set_active_box(i)} />)}\n            </div>\n    );\n\n}","import { useSelector } from \"react-redux\";\nimport { List, ListItem, ListItemText, Paper } from \"@material-ui/core\";\nimport { useCallback, useEffect, useState } from \"react\";\n\n\nconst KEYNAMES = {\n    65: 'a',\n    66: 'b',\n    67: 'c',\n    68: 'd',\n    69: 'e',\n    70: 'f',\n    71: 'g',\n    72: 'h',\n    73: 'i',\n    74: 'j',\n    75: 'k',\n    76: 'l',\n    77: 'm',\n    78: 'n',\n    79: 'o',\n    80: 'p',\n    81: 'q',\n    82: 'r',\n    83: 's',\n    84: 't',\n    85: 'u',\n    86: 'v',\n    87: 'w',\n    88: 'x',\n    89: 'y',\n    90: 'z',\n    97: 'a',\n    98: 'b',\n    99: 'c',\n    100: 'd',\n    101: 'e',\n    102: 'f',\n    103: 'g',\n    104: 'h',\n    105: 'i',\n    106: 'j',\n    107: 'k',\n    108: 'l',\n    109: 'm',\n    110: 'n',\n    111: 'o',\n    112: 'p',\n    113: 'q',\n    114: 'r',\n    115: 's',\n    116: 't',\n    117: 'u',\n    118: 'v',\n    119: 'w',\n    120: 'x',\n    121: 'y',\n    122: 'z'\n};\n\nexport default function ShortcutKeyView(props) {\n    const label_names = useSelector(state => state.dataset.labels);\n    const [shortcut_keys] = useState({0: 81, 1: 87, 2: 69, 3: 82, 4: 65, 5: 83, 6: 68, 7: 70});\n    const { selected_label, set_selected_label } = props;\n\n    const key_shortcut_map = Object.keys(shortcut_keys).reduce((acc, key) => {acc[shortcut_keys[key]] = parseInt(key); return acc;}, {});\n    const on_key_down = useCallback((e) => {\n        if (e.keyCode in key_shortcut_map) {\n            const selected_label_id = key_shortcut_map[e.keyCode];\n            if (selected_label_id < label_names.length) {\n                set_selected_label(selected_label_id);\n            }\n        }\n    }, [key_shortcut_map, set_selected_label, label_names]);\n\n    useEffect(() => {\n        window.addEventListener(\"keydown\", on_key_down);\n        return () => window.removeEventListener(\"keydown\", on_key_down);\n    }, [on_key_down]);\n\n    return (<div>\n        <Paper variant=\"outlined\">\n        <List dense>\n        {label_names.map((n, i) => <ListItem button key={i} onClick={() => props.set_selected_label(i)} selected={selected_label === i}><ListItemText primary={n + ((i in shortcut_keys) ? \"  (key: \" + KEYNAMES[shortcut_keys[i]] + \")\": \"\")}/></ListItem>)}\n        </List>\n        </Paper>\n    </div>)\n}","import { Grid, IconButton, Typography } from \"@material-ui/core\";\nimport { useCallback, useEffect } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { useParams, Link, useHistory } from \"react-router-dom\";\nimport ImageAnnotator from './image_annotator';\nimport ShortcutKeyView from './shortcut_key_view';\nimport { get_image_labels } from \"./redux/store\";\nimport { NavigateNext, NavigateBefore } from \"@material-ui/icons\";\n\n\nexport default function ImageView(props) {\n    const params = useParams();\n    const image_id = parseInt(params.image_id);\n    const num_images = useSelector(state => state.dataset.num_images);\n\n    const dispatch = useDispatch();\n    useEffect(() => {\n        dispatch(get_image_labels(image_id));\n    }, [dispatch, image_id]);\n\n    const history = useHistory();\n    const on_key_down = useCallback((e) => {\n        if (e.keyCode === 32) {\n            if (e.shiftKey) {\n                if (image_id > 0) {\n                    history.push(\"/images/\" + (image_id - 1));\n                }\n            } else {\n                if (image_id < num_images - 1) {\n                    history.push(\"/images/\" + (image_id + 1));\n                }\n            }\n        }\n    }, [image_id, history, num_images]);\n\n    useEffect(() => {\n        window.addEventListener(\"keydown\", on_key_down);\n        return () => window.removeEventListener(\"keydown\", on_key_down);\n    }, [on_key_down]);\n\n    return (\n        <div className=\"image_view\">\n            <Typography variant=\"h5\">\n                {image_id > 0 && <IconButton><Link to={\"/images/\" + (image_id - 1)}><NavigateBefore /></Link></IconButton>}\n                {image_id} / {num_images}\n                {image_id < num_images - 1 && <IconButton><Link to={\"/images/\" + (image_id + 1)}><NavigateNext /></Link></IconButton>}\n            </Typography>\n            <Grid container spacing={2}>\n                <Grid item xs={9}>\n                    <ImageAnnotator image_id={image_id} selected_label={props.selected_label} />\n                </Grid>\n                <Grid item xs={3}>\n                    <Typography variant=\"h6\">Labels</Typography>\n                    <ShortcutKeyView selected_label={props.selected_label} set_selected_label={props.set_selected_label} />\n                </Grid>\n            </Grid>\n        </div>\n    )\n}","import { AppBar, Button, Container, Toolbar, Typography } from '@material-ui/core';\nimport { Route, BrowserRouter as Router, Link, Switch } from 'react-router-dom';\nimport HomeView from './home_view';\nimport ImageView from './image_view';\nimport { useEffect, useState } from 'react';\nimport { get_metadata } from './redux/store';\nimport { useDispatch } from 'react-redux';\nimport './app.css';\nimport client from './api';\nimport { useSnackbar } from 'notistack';\n\nfunction App() {\n  const dispatch = useDispatch();\n  useEffect(() => {\n    dispatch(get_metadata());\n  }, [dispatch]);\n\n  const {enqueueSnackbar} = useSnackbar();\n  const [selected_label, set_selected_label] = useState(null);\n\n  async function save() {\n    await client.post_save();\n    enqueueSnackbar(\"Saved\");\n  }\n\n  async function stop() {\n    enqueueSnackbar(\"Server is shutting down... Please close this window.\")\n    await client.post_stop();\n    enqueueSnackbar(\"Server is successfully stopped.\"); // TODO: Server will return 500 here.\n  }\n\n  return (\n    <div className=\"App\">\n      <Router>\n        <AppBar position=\"static\" color=\"transparent\">\n          <Toolbar variant=\"dense\">\n            <Typography id=\"logo\" variant=\"h5\" component={Link} to=\"/\" color=\"inherit\">Simple Dataset Labeler</Typography>\n            <Button id=\"save_button\" onClick={save}>Save</Button>\n            <Button id=\"exit_button\" onClick={stop}>Exit</Button>\n          </Toolbar>\n        </AppBar>\n        <Container>\n          <Switch>\n            <Route path=\"/images/:image_id\"><ImageView selected_label={selected_label} set_selected_label={set_selected_label} /></Route>\n            <Route path=\"/\" exact><HomeView /></Route>\n          </Switch>\n        </Container>\n      </Router>\n   </div>\n  );\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './app';\nimport { Provider } from 'react-redux';\nimport { SnackbarProvider } from 'notistack';\nimport store from './redux/store';\n\nReactDOM.render(\n  <React.StrictMode>\n    <Provider store={store}>\n      <SnackbarProvider maxSnack={3} autoHideDuration={3000}>\n        <App />\n      </SnackbarProvider>\n    </Provider>\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n"],"sourceRoot":""}