"use strict";(self.webpackChunkjlmc=self.webpackChunkjlmc||[]).push([[137],{72137:(e,t,n)=>{n.r(t),n.d(t,{default:()=>Z});var o=n(82678),a=n(52493),s=n(33622);const i="create-model-card",l="modify-model-card-stage",r=new Map([["plotting","Plotting"],["datacleaning","Data Cleaning"],["preprocessing","Preprocessing"],["hyperparameters","Hyperparameters"],["modeltraining","Model Training"],["modelevaluation","Model Evaluation"],["misc","Ignore"]]);var c=n(63806),d=n(19129),p=n(23706),h=(n(26946),n(66678)),m=n.n(h),u=n(56271),g=n.n(u),_=n(14456),x=n(85040),v=n(73426),b=n(7179),w=n(70938),k=n.n(w),f=n(40654),C=n.n(f),E=n(99946),y=n(19850);const M=/<!--\s*@md-(\w*)\s*-->/,P=/<!--\s*@md-\w*\s*-->([\s\S]*)<!--\s*\/md-\w*\s*-->/;var R=n(90608);const S=(e,t)=>{setTimeout((()=>{e.deselectAll(),e.activeCellIndex=t,function(e,t=!1){const n=e.activeCell;"edit"===e.mode&&n&&(n.editor.hasFocus()||n.editor.focus()),t&&!e.node.contains(document.activeElement)&&e.node.focus()}(e),e.mode="edit",function(e,t){R.ElementExt.scrollIntoViewIfNeeded(e.node,t.node),e.deselectAll(),e.select(t),t.activate()}(e,e.activeCell)}),0)};var j=n(61209),$=n(51513);const N=({sectionName:e,sectionTitle:t,annotMap:n,updateAnnotMap:o,notebook:a,idx:s})=>n.has(e)?g().createElement(j.Z,{onClick:()=>{S(a,n.get(e).idx)}}):g().createElement(v.Popconfirm,{title:`Add a ${r.has(e)?"description":"new cell"} for ${t}?`,onConfirm:()=>{var n,i;a.model.cells.insert(s,new $.MarkdownCellModel({cell:{cell_type:"markdown",source:(n=e,i=t,`# ${i}\n\x3c!-- @md-${n} --\x3e\n\x3c!-- /md-${n} --\x3e`),metadata:{}}})),o((t=>{t.set(e,s)})),S(a,s)},okText:"Yes",cancelText:"No"},g().createElement(j.Z,null));(0,b.enableMapSet)();const I=(e,t)=>"author"===e?1:r.has(e)&&t.cell_ids.length>0?t.cell_ids[0]:1/0,D=C().div`
  position: relative;
  background: aliceblue;
  width: 40%;
  height: 40px;
  border-radius: 10px;
`,T=C().div`
  position: absolute;
  left: ${e=>e.left}%;
  height: 100%;
  width: 5px;
  background-color: lightskyblue;
  border-radius: 15px;
  transition: transform 0.2s, background-color 0.2s;

  &:hover {
    transform: scale(3, 1.5);
    background-color: #1890ff;
    z-index: 2;
    cursor: pointer;
  }
`,A=({notebook:e,sectionName:t,sectionContent:n,quickFix:o})=>"object"!=typeof n?null:g().createElement(g().Fragment,null,g().createElement(g().Fragment,null,g().createElement("h1",null,n.title," ",o),g().createElement(k(),null,n.description),g().createElement("div",{style:{display:"block"}},"modelname"!==t&&"cell_ids"in n&&n.cell_ids.length>0?g().createElement(D,null,n.cell_ids.map(((t,n)=>g().createElement(T,{key:n,left:t/e.model.cells.length*100,onClick:()=>S(e,t-1)})))):null),"figures"in n?n.figures.map(((e,t)=>g().createElement("img",{style:{display:"block"},key:t,src:`data:image/png;base64,${e}`}))):null)),O=({notebook:e,context:t,docManager:n,ServerResponse:o})=>{const[a,s]=(0,E.useImmer)(new Map),[i,l]=(0,E.useImmer)({});return(0,u.useEffect)((()=>{const t=(e=>{const t=new Map;if(e.model.cells){let n,o;return(0,y.each)(e.model.cells,((e,a)=>{"markdown"===e.type&&(n=e.value.text.match(M),o=e.value.text.match(P),n&&t.set(n[1],{idx:a,content:o[1]}))})),t}})(e);let n=JSON.parse(JSON.stringify(o));t.forEach(((e,t)=>{t in n&&(n[t].description=e.content)})),l((()=>n));const a="modelname";if(void 0!==n.modelname.description&&!t.has(a)){const o=e.model.cells.get(0).value;o.insert(0,"\x3c!-- @md-modelname --\x3e\n"),o.insert(o.text.length,"\n\x3c!-- /md-modelname --\x3e"),t.set(a,{idx:0,content:n.modelname.description})}s((()=>t))}),[e]),g().createElement(g().Fragment,null,g().createElement(v.Button,{type:"primary",style:{position:"sticky",top:10,float:"right"},onClick:()=>{const e=x.PathExt.dirname(t.path);let o=x.PathExt.basename(t.path);o=o.split(x.PathExt.extname(o))[0],o=o.split(" ").join("_"),o="card_"+o+".md";const a=x.PathExt.join(e,o);let s=n.findWidget(a,"default");void 0===s&&(s=n.createNew(a)),n.openOrReveal(s.context.path),s.context.ready.then((()=>{s.content.model.value.text=(e=>{let t="";return Object.entries(e).forEach((([e,n])=>{if("misc"===e)return;if("modelname"===e)return void(t+=`${n.description}\n`);const o=n.description&&"string"==typeof n.description&&n.description.trim(),a=n.figures&&n.figures.length;(o||a)&&(t+=`## ${n.title}\n`),o&&(t+=`${n.description}\n`),a&&n.figures.forEach(((e,n)=>t+=`<img alt="figure${n}" src="data:image/png;base64, ${e}">\n`))})),t})(i)}))}},"Export to MD"),Object.entries(i).map((([t,n],o)=>"misc"===t?null:g().createElement(A,{key:o,notebook:e,sectionName:t,sectionContent:n,quickFix:g().createElement(N,{sectionName:t,sectionTitle:n.title,annotMap:a,updateAnnotMap:s,notebook:e,idx:I(t,n)})}))))};class W extends a.ReactWidget{constructor(e,t,n){super(),this._notebook=e.content,this._context=e.context,this._docManager=t,this.serverResponse=n,this.addClass("jp-ReactWidget")}onUpdateRequest(){_.render(g().createElement(O,{notebook:this._notebook,context:this._context,docManager:this._docManager,ServerResponse:this.serverResponse}),this.node)}updateModel(e){this._notebook=m()(e.content)}render(){return g().createElement(O,{notebook:this._notebook,context:this._context,docManager:this._docManager,ServerResponse:this.serverResponse})}}var B=n(57254);const F=/(\[model card\] stage: )[\w ]*(.*)/,V=({notebook:e})=>{const t=g().createElement(v.Menu,null,Array.from(r.entries()).map((([t,n],o)=>g().createElement(v.Menu.Item,{key:o,onClick:()=>{e.activeCell.model.metadata.set("stage",t);const o=e.activeCell.model.value.text;o.match(F)?e.activeCell.model.value.text=o.replace(F,`$1${n}$2`):e.activeCell.model.value.insert(0,`# [model card] stage: ${n}\n`)}},n))));return g().createElement(v.Dropdown,{overlay:t},g().createElement(v.Button,null,"Select stage ",g().createElement(B.Z,null)))};class q extends a.ReactWidget{constructor(e){super(),this._notebook=e.content}updateModel(e){this._notebook=m()(e.content)}render(){return g().createElement(V,{notebook:this._notebook})}}var J=n(50297);class U extends p.StackedPanel{constructor(e,t,n,o){super(),this._app=e,this._docManager=t,this.id=n,this.title.label=o,this.title.closable=!0}onUpdateRequest(){this._view?this.updateView(this._context.localPath):this.createView(this._context.localPath)}setContext(e){this._context=e}setPanel(e){this._panel=e}getPopup(){return this._popup}async getData(e){const t={path:e};try{return await async function(e="",t={}){const n=J.ServerConnection.makeSettings(),o=x.URLExt.join(n.baseUrl,"jlmc",e);let a;try{a=await J.ServerConnection.makeRequest(o,t,n)}catch(e){throw new J.ServerConnection.NetworkError(e)}const s=await a.json();if(!a.ok)throw new J.ServerConnection.ResponseError(a,s.message);return s}("hello",{body:JSON.stringify(t),method:"POST"})}catch(e){console.error(`Error on POST /jlmc/hello ${t}.\n${e}`),alert("jlmc ran into errors. Generation Failed.")}}async updateView(e){this.getData(e).then((e=>{this._view=new W(this._panel,this._docManager,e),this._view.updateModel(this._panel),this._view.update(),this._popup=new q(this._panel),this._popup.updateModel(this._panel)}))}launchPanel(){this._popup&&(this._popup.updateModel(this._panel),new c.Popup({body:this._popup,anchor:this._panel.content.activeCell,align:"right"}).launch())}async createView(e){this.getData(e).then((e=>{this._view=new W(this._panel,this._docManager,e),this.addWidget(this._view),this._popup=new q(this._panel),this._view.updateModel(this._panel),this._popup.updateModel(this._panel)}))}createNew(e,t){return new d.DisposableDelegate((()=>{this.widgets&&this.widgets.forEach((e=>{e.isDisposed||e.dispose(),e=null})),this._popup.dispose()}))}}class L{constructor(e,t){this._app=e,this._docManager=t}createNew(e,t){let n;const o=()=>{t.ready.then((()=>{this._context=t;let o=x.PathExt.basename(t.path);o=o.split(x.PathExt.extname(o))[0],o=o.split(" ").join("_"),o+=".modelcard",n?n&&!n.isAttached?(n.setContext(this._context),n.setPanel(e),this._app.shell.add(n,"main"),this._app.shell.activateById(n.id),this._modelCardPanel=n):n&&!n.isVisible?(n.setContext(this._context),n.setPanel(e),this._app.shell.activateById(n.id),this._modelCardPanel=n):n&&(n.setContext(this._context),n.setPanel(e),n.update()):(n=new U(this._app,this._docManager,function(e){for(var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",o=n.length,a=0;a<10;a++)t+=n.charAt(Math.floor(Math.random()*o));return t}(),o),n.setContext(this._context),n.setPanel(e),this._modelCardPanel=n,this._app.commands.hasCommand(l)||(this._app.commands.addCommand(l,{label:"[Model Card] Change stage to...",execute:()=>{!function(e){e.launchPanel()}(this._modelCardPanel)}}),this._app.contextMenu.addItem({command:l,selector:".jp-CodeCell"})),this._app.docRegistry.addWidgetExtension("Notebook",n),this._app.shell.add(n,"main"),this._app.shell.activateById(n.id))}))},s=new a.ToolbarButton({tooltip:"Generate model card",className:"myButton",onClick:()=>{o()},label:"Model Card"});return e.toolbar.insertItem(0,"jupyterlabClassic",s),this._app.commands.hasCommand(i)||this._app.commands.addCommand(i,{label:"Model Card",caption:"Model Card",isVisible:()=>!1,execute:o}),s}}const Z={id:"model-card-extension",autoStart:!0,requires:[s.IDocumentManager,o.ILayoutRestorer],activate:(e,t,n)=>{console.log("JupyterLab extension jlmc is activated!");const o=new a.WidgetTracker({namespace:"model-card"});n.restore(o,{command:i,name:()=>"model-card"});const s=new L(e,t);e.docRegistry.addWidgetExtension("Notebook",s)}}}}]);