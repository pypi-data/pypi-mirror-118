BootStrap: library
From: cokelaer/damona/conda:4.9.2

%labels

    AUTHOR Thomas Cokelaer

%post

    ### For this version, we will not use conda to install sequana but pip since
    ### we now have a pure Python package.
    apt-get install -y graphviz
    # set anaconda path
    export PATH=$PATH:/usr/local/anaconda/bin

    # Sequana source code
    pip install sequana==0.10.0 --ignore-installed
    pip install sequana_rnaseq --ignore-installed # this is to avoid a warning
    #pip install ruamel.yaml --upgrade --ignore-installed

    #git clone https://github.com/biomics-pasteur-fr/MultiQC
    #cd MultiQC/
    #git pull origin Feature/RNAseqc2
    #python setup.py install

    conda install -c anaconda qt pyqt>5
    # Let us save some space
    conda clean --packages -y
    conda clean --all -y # next requires lots of space

    if [ ! -d /data ]; then mkdir /data; fi

    echo "backend:agg" > matplotlibrc

%environment
    export PATH=$PATH:/usr/local/anaconda/bin
    export LANG=C   # prevents perl for raising warnings
    export PERL5LIB=/usr/local/anaconda/lib/perl5/5.22.0
    # Issue with multiqc/click should be solved with those 2 exports
    # This one raises a warning: Error: Fontconfig warning: ignoring C.UTF-8:
    # not a valid language tag.
    export LANG=C.UTF-8
    export LC_ALL=C.UTF-8
    # according to https://github.com/uncss/uncss/issues/166, should use
    #export LC_ALL=C  but does not work ! Same error as above
    ###export LC_ALL=C.UTF-8
    #echo "backend:agg" > matplotlibrc

